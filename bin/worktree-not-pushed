#!/usr/bin/env bash

git worktree list | tail -n +2 | awk '{print $1}' | while read dir; do
  if [ -d "$dir/.git" ] || [ -f "$dir/.git" ]; then
    cd "$dir" 2>/dev/null && \
    branch=$(git rev-parse --abbrev-ref HEAD 2>/dev/null) && \
    if [ -n "$branch" ]; then
      unpushed=$(git log @{u}.. --oneline 2>/dev/null | wc -l | tr -d ' ')
      if [ "$unpushed" -gt 0 ] 2>/dev/null; then
        echo "$dir ($branch): $unpushed unpushed commit(s)"
      fi
    fi
  fi
done

# vi:ft=sh:
