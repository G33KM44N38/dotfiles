#!/bin/bash

# Required parameters:
# @raycast.schemaVersion 1
# @raycast.title pc_clean
# @raycast.mode compact

# Optional parameters:
# @raycast.icon ðŸ¤–

# Documentation:
# @raycast.description Comprehensive system and development environment cleanup
# @raycast.author me

# System memory and cache cleanup
sudo purge

# Homebrew package management
brew update && brew upgrade && brew cleanup
brew autoremove  # Remove unused dependencies

# Remove old node_modules directories
find . -name "node_modules" -type d -mtime +120 | xargs rm -rf

# Clean up iOS simulator
xcrun simctl delete unavailable

# Remove Xcode and developer-related caches
rm -rf ~/Library/Developer
rm -rf ~/Library/Caches/com.apple.dt.Xcode

# Clean Rust project build artifacts
find . -name "Cargo.toml" -type f -execdir cargo clean \;

# Remove Python cache directories
find . -name "__pycache__" -type d -exec rm -rf {} \;

# Clean CocoaPods cache
rm -rf ~/Library/Caches/CocoaPods

# Docker cleanup
docker volume prune
docker system prune -af --volumes  # More aggressive cleanup

# Clean temporary files
rm -rf ~/Library/Caches/pip
rm -rf ~/.npm
rm -rf ~/.gradle/caches

# Clear download history
sqlite3 ~/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV* 'delete from LSQuarantineEvent'

# Optional: Empty Trash
sudo rm -rf ~/.Trash/*

# Clean up merged git branches across all directories
for d in */; do 
    cd "$d"
    echo "WORKING ON $d"
    git branch --merged master | grep -v "\* master" | xargs -n 1 git branch -d
    cd ..
done


echo "Cleanup complete!"
